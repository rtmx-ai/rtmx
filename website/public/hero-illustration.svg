<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 500" fill="none">
  <defs>
    <!-- Gradient for connections -->
    <linearGradient id="lineGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" stop-color="#10b981" stop-opacity="0.9"/>
      <stop offset="100%" stop-color="#6ee7b7" stop-opacity="0.5"/>
    </linearGradient>

    <linearGradient id="lineGradReverse" x1="100%" y1="0%" x2="0%" y2="0%">
      <stop offset="0%" stop-color="#8b5cf6" stop-opacity="0.9"/>
      <stop offset="100%" stop-color="#c4b5fd" stop-opacity="0.5"/>
    </linearGradient>

    <!-- Glow effect -->
    <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>

    <!-- Card shadow -->
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="4" stdDeviation="10" flood-color="#000" flood-opacity="0.4"/>
    </filter>

    <!-- Agent glow -->
    <filter id="agentGlow" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur stdDeviation="8" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
  </defs>

  <!-- Background grid -->
  <pattern id="grid" width="50" height="50" patternUnits="userSpaceOnUse">
    <path d="M 50 0 L 0 0 0 50" fill="none" stroke="#1a1a1a" stroke-width="0.5"/>
  </pattern>
  <rect width="1200" height="500" fill="url(#grid)" opacity="0.6"/>

  <!-- ============ CONNECTION LINES (back layer) ============ -->

  <!-- Agent to Requirements (purple - creation flow) -->
  <path d="M 200 250 C 280 200, 320 200, 380 180" stroke="url(#lineGradReverse)" stroke-width="3" fill="none" filter="url(#glow)">
    <animate attributeName="stroke-dasharray" values="0,1000;200,1000" dur="2s" repeatCount="indefinite"/>
  </path>
  <path d="M 200 250 C 280 250, 320 250, 380 250" stroke="url(#lineGradReverse)" stroke-width="3" fill="none" filter="url(#glow)">
    <animate attributeName="stroke-dasharray" values="0,1000;200,1000" dur="2s" begin="0.3s" repeatCount="indefinite"/>
  </path>
  <path d="M 200 250 C 280 300, 320 300, 380 320" stroke="url(#lineGradReverse)" stroke-width="3" fill="none" filter="url(#glow)">
    <animate attributeName="stroke-dasharray" values="0,1000;200,1000" dur="2s" begin="0.6s" repeatCount="indefinite"/>
  </path>

  <!-- Requirements to Tests (green) -->
  <path d="M 520 180 Q 580 180, 620 220" stroke="url(#lineGrad)" stroke-width="2.5" fill="none"/>
  <path d="M 520 250 Q 580 250, 620 250" stroke="url(#lineGrad)" stroke-width="2.5" fill="none"/>
  <path d="M 520 320 Q 580 320, 620 280" stroke="url(#lineGrad)" stroke-width="2.5" fill="none"/>

  <!-- Tests to Status (green) -->
  <path d="M 780 250 Q 840 200, 880 180" stroke="url(#lineGrad)" stroke-width="2.5" fill="none"/>
  <path d="M 780 250 Q 840 250, 880 250" stroke="url(#lineGrad)" stroke-width="2.5" fill="none"/>
  <path d="M 780 250 Q 840 300, 880 320" stroke="url(#lineGrad)" stroke-width="2.5" fill="none"/>

  <!-- Status back to Agent (purple - verification loop) -->
  <path d="M 1000 250 C 1050 250, 1100 100, 600 50 C 200 0, 100 100, 100 250"
        stroke="#8b5cf6" stroke-width="2" stroke-dasharray="8 4" fill="none" opacity="0.6">
    <animate attributeName="stroke-dashoffset" from="0" to="-24" dur="1.5s" repeatCount="indefinite"/>
  </path>

  <!-- Loop arrow indicator -->
  <text x="600" y="35" fill="#8b5cf6" font-size="11" text-anchor="middle" font-family="system-ui" opacity="0.8">
    Closed-Loop Verification
  </text>

  <!-- ============ AGENT (left) ============ -->
  <g filter="url(#shadow)">
    <rect x="60" y="180" width="140" height="140" rx="12" fill="#171717" stroke="#8b5cf6" stroke-width="2"/>

    <!-- AI icon -->
    <circle cx="130" cy="220" r="25" fill="#1e1e1e" stroke="#8b5cf6" stroke-width="2"/>
    <text x="130" y="227" fill="#c4b5fd" font-size="20" text-anchor="middle" font-family="system-ui">AI</text>

    <text x="130" y="265" fill="#e5e7eb" font-size="12" text-anchor="middle" font-family="system-ui" font-weight="600">Claude / MCP</text>
    <text x="130" y="285" fill="#6b7280" font-size="10" text-anchor="middle" font-family="monospace">Creates specs</text>
    <text x="130" y="300" fill="#6b7280" font-size="10" text-anchor="middle" font-family="monospace">Queries status</text>
  </g>

  <!-- ============ REQUIREMENTS (center-left) ============ -->
  <g filter="url(#shadow)">
    <rect x="380" y="140" width="140" height="55" rx="6" fill="#171717" stroke="#262626"/>
    <text x="450" y="162" fill="#9ca3af" font-size="11" text-anchor="middle" font-family="monospace">REQ-AUTH-001</text>
    <text x="450" y="182" fill="#10b981" font-size="10" text-anchor="middle" font-family="system-ui">OAuth Login</text>
  </g>

  <g filter="url(#shadow)">
    <rect x="380" y="210" width="140" height="55" rx="6" fill="#171717" stroke="#262626"/>
    <text x="450" y="232" fill="#9ca3af" font-size="11" text-anchor="middle" font-family="monospace">REQ-API-001</text>
    <text x="450" y="252" fill="#10b981" font-size="10" text-anchor="middle" font-family="system-ui">REST API</text>
  </g>

  <g filter="url(#shadow)">
    <rect x="380" y="280" width="140" height="55" rx="6" fill="#171717" stroke="#262626"/>
    <text x="450" y="302" fill="#9ca3af" font-size="11" text-anchor="middle" font-family="monospace">REQ-DATA-001</text>
    <text x="450" y="322" fill="#10b981" font-size="10" text-anchor="middle" font-family="system-ui">Database</text>
  </g>

  <!-- ============ TESTS (center) ============ -->
  <g filter="url(#shadow)">
    <rect x="620" y="175" width="160" height="150" rx="10" fill="#171717" stroke="#10b981" stroke-width="2"/>

    <text x="700" y="205" fill="#e5e7eb" font-size="13" text-anchor="middle" font-family="system-ui" font-weight="600">pytest</text>

    <text x="700" y="230" fill="#6b7280" font-size="10" text-anchor="middle" font-family="monospace">@pytest.mark.req</text>

    <rect x="640" y="245" width="120" height="20" rx="3" fill="#1e1e1e"/>
    <text x="700" y="259" fill="#22c55e" font-size="11" text-anchor="middle" font-family="monospace">✓ 12 passed</text>

    <rect x="640" y="270" width="120" height="20" rx="3" fill="#1e1e1e"/>
    <text x="700" y="284" fill="#f59e0b" font-size="11" text-anchor="middle" font-family="monospace">△ 2 partial</text>

    <rect x="640" y="295" width="120" height="20" rx="3" fill="#1e1e1e"/>
    <text x="700" y="309" fill="#ef4444" font-size="11" text-anchor="middle" font-family="monospace">✗ 4 missing</text>
  </g>

  <!-- ============ STATUS (right) ============ -->
  <g filter="url(#shadow)">
    <rect x="880" y="130" width="180" height="240" rx="10" fill="#171717" stroke="#262626"/>

    <!-- Terminal header -->
    <rect x="880" y="130" width="180" height="28" rx="10" fill="#2d2d2d"/>
    <circle cx="898" cy="144" r="5" fill="#ff5f56"/>
    <circle cx="914" cy="144" r="5" fill="#ffbd2e"/>
    <circle cx="930" cy="144" r="5" fill="#27ca40"/>
    <text x="970" y="148" fill="#6b7280" font-size="9" text-anchor="middle" font-family="system-ui">rtmx status</text>

    <!-- Progress bar -->
    <text x="900" y="180" fill="#9ca3af" font-size="10" font-family="monospace">Requirements:</text>
    <rect x="900" y="188" width="140" height="14" rx="2" fill="#262626"/>
    <rect x="900" y="188" width="77" height="14" rx="2" fill="#22c55e"/>
    <rect x="977" y="188" width="22" height="14" fill="#f59e0b"/>
    <rect x="999" y="188" width="41" height="14" rx="2" fill="#ef4444"/>
    <text x="1050" y="199" fill="#9ca3af" font-size="10" font-family="monospace">54%</text>

    <!-- Stats -->
    <text x="910" y="230" fill="#22c55e" font-size="11" font-family="monospace">✓ 5 complete</text>
    <text x="910" y="250" fill="#f59e0b" font-size="11" font-family="monospace">△ 3 partial</text>
    <text x="910" y="270" fill="#ef4444" font-size="11" font-family="monospace">✗ 4 missing</text>
    <text x="910" y="295" fill="#6b7280" font-size="10" font-family="monospace">(12 total)</text>

    <!-- Phase status -->
    <text x="910" y="325" fill="#9ca3af" font-size="9" font-family="monospace">Phase 1: 91.7% ▲</text>
    <text x="910" y="340" fill="#9ca3af" font-size="9" font-family="monospace">Phase 2: 25.0% ▲</text>
    <text x="910" y="355" fill="#6b7280" font-size="9" font-family="monospace">Phase 3: 0.0% ○</text>
  </g>

  <!-- ============ LABELS ============ -->
  <text x="130" y="145" fill="#8b5cf6" font-size="13" text-anchor="middle" font-family="system-ui" font-weight="600">Agent</text>
  <text x="450" y="115" fill="#6b7280" font-size="13" text-anchor="middle" font-family="system-ui" font-weight="600">Requirements</text>
  <text x="700" y="155" fill="#10b981" font-size="13" text-anchor="middle" font-family="system-ui" font-weight="600">Tests</text>
  <text x="970" y="110" fill="#6b7280" font-size="13" text-anchor="middle" font-family="system-ui" font-weight="600">Status</text>

  <!-- Flow arrows/labels -->
  <text x="290" y="200" fill="#c4b5fd" font-size="9" text-anchor="middle" font-family="system-ui" opacity="0.8">writes</text>
  <text x="570" y="200" fill="#6ee7b7" font-size="9" text-anchor="middle" font-family="system-ui" opacity="0.8">linked</text>
  <text x="830" y="200" fill="#6ee7b7" font-size="9" text-anchor="middle" font-family="system-ui" opacity="0.8">reports</text>
  <text x="130" y="430" fill="#c4b5fd" font-size="9" text-anchor="middle" font-family="system-ui" opacity="0.8">queries via MCP</text>

  <!-- Animated data flow dots -->
  <circle r="5" fill="#8b5cf6" filter="url(#glow)">
    <animateMotion dur="2s" repeatCount="indefinite" path="M 200 250 C 280 250, 320 250, 380 250"/>
  </circle>
  <circle r="5" fill="#10b981" filter="url(#glow)">
    <animateMotion dur="1.5s" repeatCount="indefinite" path="M 520 250 Q 580 250, 620 250"/>
  </circle>
  <circle r="5" fill="#10b981" filter="url(#glow)">
    <animateMotion dur="1.5s" repeatCount="indefinite" begin="0.5s" path="M 780 250 Q 840 250, 880 250"/>
  </circle>

  <!-- Loop dot -->
  <circle r="4" fill="#8b5cf6" opacity="0.8">
    <animateMotion dur="4s" repeatCount="indefinite"
      path="M 1000 250 C 1050 250, 1100 100, 600 50 C 200 0, 100 100, 100 250"/>
  </circle>
</svg>
