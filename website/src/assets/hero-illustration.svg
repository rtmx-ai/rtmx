<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 550" fill="none">
  <defs>
    <!-- Gradients -->
    <linearGradient id="lineGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" stop-color="#10b981"/>
      <stop offset="100%" stop-color="#6ee7b7"/>
    </linearGradient>

    <linearGradient id="purpleGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" stop-color="#8b5cf6"/>
      <stop offset="100%" stop-color="#c4b5fd"/>
    </linearGradient>

    <!-- Glow effect -->
    <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>

    <!-- Card shadow -->
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="4" stdDeviation="10" flood-color="#000" flood-opacity="0.4"/>
    </filter>

    <!-- Line draw animation mask -->
    <mask id="lineMask">
      <rect x="0" y="0" width="1200" height="550" fill="white"/>
    </mask>
  </defs>

  <!-- Background grid -->
  <pattern id="grid" width="50" height="50" patternUnits="userSpaceOnUse">
    <path d="M 50 0 L 0 0 0 50" fill="none" stroke="#1a1a1a" stroke-width="0.5"/>
  </pattern>
  <rect width="1200" height="550" fill="url(#grid)" opacity="0.6"/>

  <!-- ============ STAGE 1: AGENT (appears first) ============ -->
  <g class="stage-1" opacity="0">
    <g filter="url(#shadow)">
      <rect x="60" y="150" width="140" height="140" rx="12" fill="#171717" stroke="#8b5cf6" stroke-width="2"/>
      <circle cx="130" cy="195" r="28" fill="#1e1e1e" stroke="#8b5cf6" stroke-width="2"/>
      <text x="130" y="203" fill="#c4b5fd" font-size="22" text-anchor="middle" font-family="system-ui" font-weight="600">AI</text>
      <text x="130" y="245" fill="#e5e7eb" font-size="13" text-anchor="middle" font-family="system-ui" font-weight="600">Claude / MCP</text>
      <text x="130" y="268" fill="#6b7280" font-size="10" text-anchor="middle" font-family="monospace">Creates specs</text>
      <text x="130" y="282" fill="#6b7280" font-size="10" text-anchor="middle" font-family="monospace">Queries status</text>
    </g>
    <text x="130" y="120" fill="#8b5cf6" font-size="13" text-anchor="middle" font-family="system-ui" font-weight="600">Agent</text>
  </g>

  <!-- ============ STAGE 2: CONNECTIONS TO REQUIREMENTS ============ -->
  <g class="stage-2" opacity="0">
    <path d="M 200 195 C 280 160, 320 155, 380 150" stroke="url(#purpleGrad)" stroke-width="2.5" fill="none" stroke-dasharray="300" stroke-dashoffset="300">
      <animate attributeName="stroke-dashoffset" to="0" dur="0.6s" fill="freeze" begin="stage2.begin"/>
    </path>
    <path d="M 200 220 C 280 220, 320 220, 380 220" stroke="url(#purpleGrad)" stroke-width="2.5" fill="none" stroke-dasharray="300" stroke-dashoffset="300">
      <animate attributeName="stroke-dashoffset" to="0" dur="0.6s" fill="freeze" begin="stage2.begin+0.15s"/>
    </path>
    <path d="M 200 245 C 280 280, 320 290, 380 290" stroke="url(#purpleGrad)" stroke-width="2.5" fill="none" stroke-dasharray="300" stroke-dashoffset="300">
      <animate attributeName="stroke-dashoffset" to="0" dur="0.6s" fill="freeze" begin="stage2.begin+0.3s"/>
    </path>
  </g>

  <!-- ============ STAGE 3: REQUIREMENTS ============ -->
  <g class="stage-3" opacity="0">
    <g filter="url(#shadow)">
      <rect x="380" y="115" width="140" height="55" rx="6" fill="#171717" stroke="#262626"/>
      <text x="450" y="138" fill="#9ca3af" font-size="11" text-anchor="middle" font-family="monospace">REQ-AUTH-001</text>
      <text x="450" y="158" fill="#10b981" font-size="10" text-anchor="middle" font-family="system-ui">OAuth Login</text>
    </g>
    <g filter="url(#shadow)">
      <rect x="380" y="185" width="140" height="55" rx="6" fill="#171717" stroke="#262626"/>
      <text x="450" y="208" fill="#9ca3af" font-size="11" text-anchor="middle" font-family="monospace">REQ-API-001</text>
      <text x="450" y="228" fill="#10b981" font-size="10" text-anchor="middle" font-family="system-ui">REST API</text>
    </g>
    <g filter="url(#shadow)">
      <rect x="380" y="255" width="140" height="55" rx="6" fill="#171717" stroke="#262626"/>
      <text x="450" y="278" fill="#9ca3af" font-size="11" text-anchor="middle" font-family="monospace">REQ-DATA-001</text>
      <text x="450" y="298" fill="#10b981" font-size="10" text-anchor="middle" font-family="system-ui">Database</text>
    </g>
    <text x="450" y="90" fill="#6b7280" font-size="13" text-anchor="middle" font-family="system-ui" font-weight="600">Requirements</text>
  </g>

  <!-- ============ STAGE 4: CONNECTIONS TO TESTS ============ -->
  <g class="stage-4" opacity="0">
    <path d="M 520 145 Q 570 145, 620 185" stroke="url(#lineGrad)" stroke-width="2.5" fill="none" stroke-dasharray="200" stroke-dashoffset="200">
      <animate attributeName="stroke-dashoffset" to="0" dur="0.5s" fill="freeze" begin="stage4.begin"/>
    </path>
    <path d="M 520 215 Q 570 215, 620 215" stroke="url(#lineGrad)" stroke-width="2.5" fill="none" stroke-dasharray="200" stroke-dashoffset="200">
      <animate attributeName="stroke-dashoffset" to="0" dur="0.5s" fill="freeze" begin="stage4.begin+0.1s"/>
    </path>
    <path d="M 520 285 Q 570 285, 620 245" stroke="url(#lineGrad)" stroke-width="2.5" fill="none" stroke-dasharray="200" stroke-dashoffset="200">
      <animate attributeName="stroke-dashoffset" to="0" dur="0.5s" fill="freeze" begin="stage4.begin+0.2s"/>
    </path>
  </g>

  <!-- ============ STAGE 5: TESTS ============ -->
  <g class="stage-5" opacity="0">
    <g filter="url(#shadow)">
      <rect x="620" y="145" width="160" height="160" rx="10" fill="#171717" stroke="#10b981" stroke-width="2"/>
      <text x="700" y="175" fill="#e5e7eb" font-size="14" text-anchor="middle" font-family="system-ui" font-weight="600">pytest</text>
      <text x="700" y="197" fill="#6b7280" font-size="10" text-anchor="middle" font-family="monospace">@pytest.mark.req</text>
      <rect x="640" y="212" width="120" height="24" rx="4" fill="#1e1e1e"/>
      <text x="700" y="229" fill="#22c55e" font-size="12" text-anchor="middle" font-family="monospace">✓ 12 passed</text>
      <rect x="640" y="241" width="120" height="24" rx="4" fill="#1e1e1e"/>
      <text x="700" y="258" fill="#f59e0b" font-size="12" text-anchor="middle" font-family="monospace">△ 2 partial</text>
      <rect x="640" y="270" width="120" height="24" rx="4" fill="#1e1e1e"/>
      <text x="700" y="287" fill="#ef4444" font-size="12" text-anchor="middle" font-family="monospace">✗ 4 missing</text>
    </g>
    <text x="700" y="125" fill="#10b981" font-size="13" text-anchor="middle" font-family="system-ui" font-weight="600">Tests</text>
  </g>

  <!-- ============ STAGE 6: CONNECTIONS TO STATUS ============ -->
  <g class="stage-6" opacity="0">
    <path d="M 780 190 Q 830 160, 880 155" stroke="url(#lineGrad)" stroke-width="2.5" fill="none" stroke-dasharray="200" stroke-dashoffset="200">
      <animate attributeName="stroke-dashoffset" to="0" dur="0.5s" fill="freeze" begin="stage6.begin"/>
    </path>
    <path d="M 780 225 Q 830 225, 880 225" stroke="url(#lineGrad)" stroke-width="2.5" fill="none" stroke-dasharray="200" stroke-dashoffset="200">
      <animate attributeName="stroke-dashoffset" to="0" dur="0.5s" fill="freeze" begin="stage6.begin+0.1s"/>
    </path>
    <path d="M 780 260 Q 830 290, 880 295" stroke="url(#lineGrad)" stroke-width="2.5" fill="none" stroke-dasharray="200" stroke-dashoffset="200">
      <animate attributeName="stroke-dashoffset" to="0" dur="0.5s" fill="freeze" begin="stage6.begin+0.2s"/>
    </path>
  </g>

  <!-- ============ STAGE 7: STATUS ============ -->
  <g class="stage-7" opacity="0">
    <g filter="url(#shadow)">
      <rect x="880" y="105" width="180" height="240" rx="10" fill="#171717" stroke="#262626"/>
      <rect x="880" y="105" width="180" height="28" rx="10" fill="#2d2d2d"/>
      <circle cx="898" cy="119" r="5" fill="#ff5f56"/>
      <circle cx="914" cy="119" r="5" fill="#ffbd2e"/>
      <circle cx="930" cy="119" r="5" fill="#27ca40"/>
      <text x="980" y="123" fill="#6b7280" font-size="9" text-anchor="middle" font-family="system-ui">rtmx status</text>
      <text x="900" y="158" fill="#9ca3af" font-size="10" font-family="monospace">Requirements:</text>
      <rect x="900" y="166" width="140" height="14" rx="2" fill="#262626"/>
      <rect x="900" y="166" width="0" height="14" rx="2" fill="#22c55e">
        <animate attributeName="width" to="77" dur="0.8s" fill="freeze" begin="stage7.begin+0.3s"/>
      </rect>
      <rect x="977" y="166" width="0" height="14" fill="#f59e0b">
        <animate attributeName="width" to="22" dur="0.3s" fill="freeze" begin="stage7.begin+0.6s"/>
      </rect>
      <rect x="999" y="166" width="0" height="14" rx="2" fill="#ef4444">
        <animate attributeName="width" to="41" dur="0.4s" fill="freeze" begin="stage7.begin+0.8s"/>
      </rect>
      <text x="1050" y="177" fill="#9ca3af" font-size="10" font-family="monospace">54%</text>
      <text x="910" y="210" fill="#22c55e" font-size="11" font-family="monospace">✓ 5 complete</text>
      <text x="910" y="230" fill="#f59e0b" font-size="11" font-family="monospace">△ 3 partial</text>
      <text x="910" y="250" fill="#ef4444" font-size="11" font-family="monospace">✗ 4 missing</text>
      <text x="910" y="275" fill="#6b7280" font-size="10" font-family="monospace">(12 total)</text>
      <text x="910" y="305" fill="#9ca3af" font-size="9" font-family="monospace">Phase 1: 91.7% ▲</text>
      <text x="910" y="320" fill="#9ca3af" font-size="9" font-family="monospace">Phase 2: 25.0% ▲</text>
      <text x="910" y="335" fill="#6b7280" font-size="9" font-family="monospace">Phase 3: 0.0% ○</text>
    </g>
    <text x="970" y="85" fill="#6b7280" font-size="13" text-anchor="middle" font-family="system-ui" font-weight="600">Status</text>
  </g>

  <!-- ============ STAGE 8: CLOSED LOOP ============ -->
  <g class="stage-8" opacity="0">
    <path d="M 1020 225 C 1100 225, 1150 80, 600 30 C 150 -20, 50 100, 60 220"
          stroke="#8b5cf6" stroke-width="2.5" stroke-dasharray="1500" stroke-dashoffset="1500" fill="none" opacity="0.7">
      <animate attributeName="stroke-dashoffset" to="0" dur="2s" fill="freeze" begin="stage8.begin"/>
    </path>
  </g>

  <!-- ============ FOOTER: WORKFLOW LEGEND ============ -->
  <rect x="0" y="420" width="1200" height="130" fill="#0d0d0d"/>
  <line x1="0" y1="420" x2="1200" y2="420" stroke="#262626" stroke-width="1"/>

  <!-- Main tagline -->
  <text x="600" y="460" fill="#f9fafb" font-size="22" text-anchor="middle" font-family="system-ui" font-weight="700">
    Distributed Closed-Loop Verification
  </text>

  <!-- Workflow steps - these highlight as animation progresses -->
  <g class="step step-1" opacity="0.3">
    <g transform="translate(100, 490)">
      <circle cx="0" cy="12" r="16" fill="#8b5cf6" opacity="0.2"/>
      <text x="0" y="17" fill="#8b5cf6" font-size="14" text-anchor="middle" font-family="system-ui" font-weight="700">1</text>
      <text x="40" y="10" fill="#c4b5fd" font-size="11" font-family="system-ui" font-weight="600">WRITE</text>
      <text x="40" y="26" fill="#6b7280" font-size="10" font-family="system-ui">Agent creates specs</text>
    </g>
  </g>

  <g class="step step-2" opacity="0.3">
    <g transform="translate(320, 490)">
      <circle cx="0" cy="12" r="16" fill="#10b981" opacity="0.2"/>
      <text x="0" y="17" fill="#10b981" font-size="14" text-anchor="middle" font-family="system-ui" font-weight="700">2</text>
      <text x="40" y="10" fill="#6ee7b7" font-size="11" font-family="system-ui" font-weight="600">LINK</text>
      <text x="40" y="26" fill="#6b7280" font-size="10" font-family="system-ui">Tests trace to requirements</text>
    </g>
  </g>

  <g class="step step-3" opacity="0.3">
    <g transform="translate(560, 490)">
      <circle cx="0" cy="12" r="16" fill="#10b981" opacity="0.2"/>
      <text x="0" y="17" fill="#10b981" font-size="14" text-anchor="middle" font-family="system-ui" font-weight="700">3</text>
      <text x="40" y="10" fill="#6ee7b7" font-size="11" font-family="system-ui" font-weight="600">REPORT</text>
      <text x="40" y="26" fill="#6b7280" font-size="10" font-family="system-ui">Status updates in real-time</text>
    </g>
  </g>

  <g class="step step-4" opacity="0.3">
    <g transform="translate(800, 490)">
      <circle cx="0" cy="12" r="16" fill="#8b5cf6" opacity="0.2"/>
      <text x="0" y="17" fill="#8b5cf6" font-size="14" text-anchor="middle" font-family="system-ui" font-weight="700">4</text>
      <text x="40" y="10" fill="#c4b5fd" font-size="11" font-family="system-ui" font-weight="600">VERIFY</text>
      <text x="40" y="26" fill="#6b7280" font-size="10" font-family="system-ui">Agent queries via MCP</text>
    </g>
  </g>

  <g class="step step-loop" opacity="0.3">
    <g transform="translate(1020, 490)">
      <path d="M 0 12 C 30 -10, 60 -10, 60 12 C 60 34, 30 34, 0 12" stroke="#8b5cf6" stroke-width="2" fill="none"/>
      <text x="30" y="17" fill="#8b5cf6" font-size="9" text-anchor="middle" font-family="system-ui" font-weight="600">LOOP</text>
    </g>
  </g>

  <!-- Animation orchestration using CSS -->
  <style>
    .stage-1, .stage-2, .stage-3, .stage-4, .stage-5, .stage-6, .stage-7, .stage-8 {
      animation-fill-mode: forwards;
      animation-timing-function: ease-out;
    }

    .stage-1 { animation: fadeIn 0.5s 0.5s forwards; }
    .stage-2 { animation: fadeIn 0.3s 1.2s forwards; }
    .stage-3 { animation: fadeIn 0.5s 1.8s forwards; }
    .stage-4 { animation: fadeIn 0.3s 2.5s forwards; }
    .stage-5 { animation: fadeIn 0.5s 3s forwards; }
    .stage-6 { animation: fadeIn 0.3s 3.7s forwards; }
    .stage-7 { animation: fadeIn 0.5s 4.2s forwards; }
    .stage-8 { animation: fadeIn 0.5s 5.5s forwards; }

    .step-1 { animation: highlight 0.3s 0.5s forwards; }
    .step-2 { animation: highlight 0.3s 2.5s forwards; }
    .step-3 { animation: highlight 0.3s 3.7s forwards; }
    .step-4 { animation: highlight 0.3s 5.5s forwards; }
    .step-loop { animation: highlight 0.3s 6s forwards; }

    @keyframes fadeIn {
      to { opacity: 1; }
    }

    @keyframes highlight {
      to { opacity: 1; }
    }
  </style>

  <!-- Named animation begin triggers -->
  <set attributeName="visibility" begin="1.2s" id="stage2"/>
  <set attributeName="visibility" begin="2.5s" id="stage4"/>
  <set attributeName="visibility" begin="3.7s" id="stage6"/>
  <set attributeName="visibility" begin="4.2s" id="stage7"/>
  <set attributeName="visibility" begin="5.5s" id="stage8"/>
</svg>
